# **OCR Pipeline Deployment Guide (Clean & Proper Version)**

## üöÄ **Quick Start Commands**

### **Windows (PowerShell)**

```powershell
# Development (Recommended)
.\deploy.ps1 -Target docker-compose -Environment dev

# Production
.\deploy.ps1 -Target docker-compose -Environment prod

# Kubernetes Dev
.\deploy.ps1 -Target k8s -Environment dev

# Kubernetes Prod
.\deploy.ps1 -Target k8s -Environment prod
```

### **Linux/macOS (Bash)**

```bash
# Make executable
chmod +x deploy.sh

# Development (Recommended)
./deploy.sh docker-compose dev

# Production
./deploy.sh docker-compose prod

# Kubernetes Dev
./deploy.sh k8s dev

# Kubernetes Prod
./deploy.sh k8s prod
```

---

## üì¶ **Docker Compose Manual Commands**

### **Development**

### Development
```powershell
# Start
docker-compose -f compose.dev.yaml up -d

# Stop
docker-compose -f compose.dev.yaml down

# Logs
docker-compose -f compose.dev.yaml logs -f

# Rebuild
docker-compose -f compose.dev.yaml build --no-cache
```

### **Production**

```powershell
# Start
docker-compose -f compose.yaml up -d

# Stop
docker-compose -f compose.yaml down

# Logs
docker-compose -f compose.yaml logs -f
```

---

## ‚ò∏Ô∏è **Kubernetes Manual Commands**

### **Build Images**

```powershell
# Dev
docker build -t ocr-pipeline:dev -f Dockerfile.dev .

# Prod
docker build -t ocr-pipeline:latest -f Dockerfile .
```

### **Deploy**

```powershell
# Dev
kubectl apply -f k8s/deployment-dev.yaml

# Prod
kubectl apply -f k8s/deployment.yaml
```

### **Check Status**

```powershell
# Dev
kubectl get all -n ocr-pipeline-dev

# Prod
kubectl get all -n ocr-pipeline
```

### **View Logs**

```powershell
# Dev
kubectl logs -f deployment/flask-app-dev -n ocr-pipeline-dev

# Prod
kubectl logs -f deployment/flask-app-deployment -n ocr-pipeline
```

### **Port Forward**

```powershell
# Dev
kubectl port-forward -n ocr-pipeline-dev svc/flask-app-service 5000:5000

# Prod
kubectl port-forward -n ocr-pipeline svc/flask-app-service 5000:5000
```

### **Delete Deployment**

```powershell
# Dev
kubectl delete -f k8s/deployment-dev.yaml

# Prod
kubectl delete -f k8s/deployment.yaml
```

---

## üîß **Direct Development (Without Containers)**

### **Backend**

```powershell
.\start-flask.ps1
# or
cd backend
python -m flask run --host=0.0.0.0 --port=5000 --debug
```

### **Frontend**

```powershell
cd frontend
bun install
bun run start
```

---

## üåê **Access URLs**

### **Docker Compose (Dev)**

* Frontend: [http://localhost:4200](http://localhost:4200)
* Backend: [http://localhost:5000](http://localhost:5000)

### **Docker Compose (Prod)**

* App: [http://localhost](http://localhost)

### **Kubernetes (after port-forward)**

* [http://localhost:5000](http://localhost:5000)

### **With Nginx**

* API: [http://api.localhost](http://api.localhost)
* Auth: [http://auth.localhost](http://auth.localhost)
* App: [http://app.localhost](http://app.localhost)

---

## üîç **Troubleshooting**

### **Docker**

```powershell
# Check Docker
docker version

# View containers
docker ps -a

# View logs
docker logs <container-name> -f

# Clean up
docker container prune -f
docker image prune -a -f
```

### **Kubernetes**

```powershell
# Check cluster
kubectl cluster-info
kubectl config current-context

# Check pods
kubectl get pods -n ocr-pipeline -o wide

# Describe pod
kubectl describe pod <pod-name> -n ocr-pipeline

# Check events
kubectl get events -n ocr-pipeline --sort-by='.lastTimestamp'

# Shell into pod
kubectl exec -it <pod-name> -n ocr-pipeline -- /bin/bash
```

---

## üí° **Common Workflows**

### **Fresh Start**

```powershell
docker-compose -f compose.dev.yaml down -v
kubectl delete -f k8s/deployment-dev.yaml
docker rmi ocr-pipeline:dev ocr-pipeline:latest
.\deploy.ps1 -Target docker-compose -Environment dev
```

### **Quick Restart**

```powershell
# Docker
docker-compose -f compose.dev.yaml restart

# Kubernetes
kubectl rollout restart deployment/flask-app-dev -n ocr-pipeline-dev
```

### **Update & Redeploy**

```powershell
# Docker Compose
.\deploy.ps1 -Target docker-compose -Environment dev

# Kubernetes
docker build -t ocr-pipeline:dev -f Dockerfile.dev .
kubectl rollout restart deployment/flask-app-dev -n ocr-pipeline-dev
```

---

# üñ•Ô∏è **One-Time Setup**

## **Windows**

```powershell
# Install Docker
.\setup-server.ps1

# Setup Nginx (optional, for subdomains)
.\setup-nginx.ps1

# Deploy
.\deploy.ps1 -Target docker-compose -Environment dev
```

**You only need `setup-nginx.ps1` when doing local development with subdomains.**
Not required for real production servers.

---

## **Linux**

```bash
# Install Docker
chmod +x setup-server.sh
sudo ./setup-server.sh

# Optional: setup Nginx for subdomains
sudo ./setup-nginx.sh

# Deploy
chmod +x deploy.sh
./deploy.sh docker-compose prod
./deploy.sh docker-compose dev
```